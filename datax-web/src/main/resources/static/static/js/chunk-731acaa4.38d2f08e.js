(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-731acaa4"],{"05a0":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"filter-container"},[n("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-refresh"},on:{click:t.handleRunJob}},[t._v("\n      启动任务\n    ")]),t._v(" "),n("el-select",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"Type",clearable:""},on:{change:t.handleJobChange,clear:t.handleJobClear},model:{value:t.jobId,callback:function(e){t.jobId=e},expression:"jobId"}},t._l(t.pluginList,function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),t._v(" "),n("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-refresh"},on:{click:t.getJobList}},[t._v("\n      刷新任务\n    ")]),t._v(" "),n("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-trash"},on:{click:function(e){t.templateJson={}}}},[t._v("\n      清空json\n    ")]),t._v(" "),n("el-button",{directives:[{name:"show",rawName:"v-show",value:t.jobId,expression:"jobId"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-document"},on:{click:t.handleViewJobLog}},[t._v("\n      查看日志\n    ")])],1),t._v(" "),n("div",{staticClass:"editor-container"},[n("div",{staticStyle:{width:"90%","margin-bottom":"12px"}},[n("el-input",{attrs:{autosize:{minRows:3,maxRows:6},type:"textarea",placeholder:"动态参数配置，如无请忽略"},model:{value:t.dynamicArgs,callback:function(e){t.dynamicArgs=e},expression:"dynamicArgs"}}),t._v(" "),n("el-button",{staticClass:"filter-item",attrs:{type:"default",icon:"el-icon-refresh"},on:{click:t.extractGetDynamicArgs}},[t._v("\n        解析动态参数\n      ")])],1),t._v(" "),n("json-editor",{ref:"jsonEditor",model:{value:t.templateJson,callback:function(e){t.templateJson=e},expression:"templateJson"}})],1),t._v(" "),n("el-dialog",{attrs:{title:"日志查看",visible:t.logShow},on:{"update:visible":function(e){t.logShow=e}}},[n("div",{staticClass:"log-container"},[n("pre",{attrs:{loading:t.logLoading},domProps:{textContent:t._s(t.logContent)}})]),t._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.loadLog()}}},[t._v("\n        刷新日志\n      ")])],1)])],1)},i=[],a=(n("4917"),n("ac4d"),n("8a81"),n("ac6a"),n("b775"));function r(t){return Object(a["a"])({url:"/api/runJob",method:"post",data:t})}function s(t){return Object(a["a"])({url:"/api/runJobLog",method:"post",data:t})}var l=n("d4a6"),c=n("fa7e"),u={components:{JsonEditor:c["a"]},data:function(){return{templateJson:{},listQuery:{current:1,size:200},pluginList:[1,2],jobId:void 0,jobLogQuery:{id:void 0,fromLineNum:0},logContent:void 0,logShow:!1,logLoading:!1,dynamicArgs:""}},created:function(){this.getJobList()},methods:{getJobList:function(){var t=this;Object(l["d"])(this.listQuery).then(function(e){console.log(e),t.jobId=void 0,t.jobLogQuery.fromLineNum=0,t.logContent=void 0;var n=e.records;t.pluginList=n})},handleRunJob:function(){var t=this,e={jobConfigId:this.jobId,jobJson:this.templateJson,dynamicArgs:this.dynamicArgs};void 0===this.jobId?r(e).then(function(e){t.$notify({title:"Success",message:"启动成功",type:"success",duration:2e3}),t.handleViewJobLog()}):s(e).then(function(e){t.$notify({title:"Success",message:"启动成功",type:"success",duration:2e3})})},handleViewJobLog:function(){void 0!==this.jobId&&(this.jobLogQuery.id=this.jobId,!1===this.logShow&&(this.logShow=!0),this.loadLog())},loadLog:function(){var t=this;this.logLoading=!0,Object(l["f"])(this.jobLogQuery).then(function(e){"\n"===e.logContent||(t.logContent=e.logContent),t.logLoading=!1})},handleJobChange:function(t){this.jobId=t,this.jobLogQuery.fromLineNum=0;var e=!0,n=!1,o=void 0;try{for(var i,a=this.pluginList[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var r=i.value;if(r.id===this.jobId){this.templateJson=JSON.parse(r.configJson);break}}}catch(s){n=!0,o=s}finally{try{e||null==a.return||a.return()}finally{if(n)throw o}}},handleJobClear:function(){this.jobId=void 0,this.logShow=!1,this.logContent=void 0},extractGetDynamicArgs:function(){var t=this.templateJson.match(/\$\{\w+\}/g);console.log(t);var e=t.map(function(t){return/\w+/.exec(t)[0]}),n=[],o={};e.forEach(function(t){o[t]=""}),console.log(n),this.dynamicArgs=JSON.stringify(o)}}},d=u,f=(n("f86e"),n("2877")),h=Object(f["a"])(d,o,i,!1,null,"2a948116",null);e["default"]=h.exports},9803:function(t,e,n){},b8b0:function(t,e,n){"use strict";var o=n("f84c"),i=n.n(o);i.a},d4a6:function(t,e,n){"use strict";n.d(e,"d",function(){return i}),n.d(e,"c",function(){return a}),n.d(e,"e",function(){return r}),n.d(e,"a",function(){return s}),n.d(e,"b",function(){return l}),n.d(e,"f",function(){return c});var o=n("b775");function i(t){return Object(o["a"])({url:"/api/jobConfig",method:"get",params:t})}function a(t){return Object(o["a"])({url:"/api/jobConfig/"+t,method:"get"})}function r(t){return Object(o["a"])({url:"/api/jobConfig/",method:"put",data:t})}function s(t){return Object(o["a"])({url:"/api/jobConfig/",method:"post",data:t})}function l(t){return Object(o["a"])({url:"/api/jobConfig/",method:"delete",params:t})}function c(t){return Object(o["a"])({url:"/api/viewJobLog",method:"get",params:t})}},f84c:function(t,e,n){},f86e:function(t,e,n){"use strict";var o=n("9803"),i=n.n(o);i.a},fa7e:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"json-editor"},[n("textarea",{ref:"textarea"})])},i=[],a=n("56b3"),r=n.n(a);n("0dd0"),n("a7be"),n("acdf"),n("f9d4"),n("8822"),n("d2de");n("ae67");var s={name:"JsonEditor",props:["value"],data:function(){return{jsonEditor:!1}},watch:{value:function(t){var e=this.jsonEditor.getValue();t!==e&&this.jsonEditor.setValue(JSON.stringify(this.value,null,2))}},mounted:function(){var t=this;this.jsonEditor=r.a.fromTextArea(this.$refs.textarea,{lineNumbers:!0,mode:"application/json",gutters:["CodeMirror-lint-markers"],theme:"rubyblue",lint:!0}),this.jsonEditor.setValue(JSON.stringify(this.value,null,2)),this.jsonEditor.on("change",function(e){t.$emit("changed",e.getValue()),t.$emit("input",e.getValue())})},methods:{getValue:function(){return this.jsonEditor.getValue()}}},l=s,c=(n("b8b0"),n("2877")),u=Object(c["a"])(l,o,i,!1,null,"fad11014",null);e["a"]=u.exports}}]);